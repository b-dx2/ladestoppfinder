<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charge and Eat - Ladestoppfinder Deutschland - Laden und Essen ‚Äì Tesla, IONITY, EnBW, McDonald's, Burger King</title>
    <meta name="description" content="Finde Ladestopps f√ºr Elektroautos in Deutschland. Entdecke Tesla Supercharger, IONITY und EnBW Ladestationen mit Restaurants wie McDonald's und Burger King. Plane deine Pause an der Autobahn f√ºr HPC-Laden und FastFood."/>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <!-- Goatcounter -->
    <script data-goatcounter="https://chargeandeat.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

    <style>
        /* --- CSS VARIABLES & THEMES --- */
        :root {
            /* Default: Dark Mode */
            --bg-color: #121212;
            --header-bg: #1e1e1e;
            --sidebar-bg: #1e1e1e; /* Hintergrund f√ºr das Men√º */
            --text-color: #ffffff;
            --muted-text: #b0b0b0;
            --card-bg: #2c2c2c;
            
            /* Picker Colors */
            --picker-bg: #333;
            --picker-highlight: rgba(255, 255, 255, 0.1);
            --charger-color: #64b5f6; /* Hellblau */
            --food-color: #ffb74d;    /* Orange */
            --btn-border: #555;
            --shadow-color: rgba(0,0,0,0.5);
        }
        
        /* Light Mode Klasse */
        body.light-mode {
            --bg-color: #f5f5f5;
            --header-bg: #ffffff;
            --sidebar-bg: #ffffff;
            --text-color: #333333;
            --muted-text: #666666;
            --card-bg: #ffffff;

            --picker-bg: #e0e0e0;
            --picker-highlight: rgba(0, 0, 0, 0.05);
            --charger-color: #1976d2;
            --food-color: #d84315;
            --btn-border: #ccc;
            --shadow-color: rgba(0,0,0,0.2);
        }

        /* --- BASIC SETUP --- */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            background-color: var(--header-bg);
            padding: 0.5rem 1rem 0 1rem;
            box-shadow: 0 4px 10px var(--shadow-color);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        h1 {
            margin: 0 0 0.5rem 0;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
        }
        
        h2 {
            margin: 1.5rem 0 0.5rem 0;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--charger-color);
            padding-bottom: 5px;
            display: inline-block;
        }

        h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        p {
            line-height: 1.5;
            color: var(--muted-text);
            margin-bottom: 1rem;
        }

        /* --- MENU BUTTON --- */
        .menu-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            cursor: pointer;
            background: transparent;
            font-size: 1.8rem;
            color: var(--text-color);
            user-select: none;
            z-index: 1100;
            padding: 5px;
        }
        
        .menu-btn:hover {
            opacity: 0.7;
        }

        /* --- SIDEBAR MENU OVERLAY (1/3 Width) --- */
        .menu-overlay {
            position: fixed;
            top: 0; 
            right: 0;  /* Rechts ausgerichtet */
            bottom: 0;
            /* Desktop: 33%, aber mind. 350px damit Text passt */
            width: 33%; 
            min-width: 350px;
            
            background-color: var(--sidebar-bg); /* Solider Hintergrund */
            z-index: 2000;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            box-sizing: border-box;
            
            /* Animation: Slide In von rechts */
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
            
            /* Schatten nach Links werfen f√ºr 3D Effekt √ºber der Karte */
            box-shadow: -5px 0 25px rgba(0,0,0,0.5);
            overflow-y: auto; 
        }

        .menu-overlay.open {
            transform: translateX(0); /* F√§hrt rein auf 0 */
        }

        /* Responsive: Auf Handys volle Breite */
        @media (max-width: 600px) {
            .menu-overlay {
                width: 100%;
                min-width: 0;
            }
        }

        .menu-content {
            width: 100%;
            padding-bottom: 3rem;
        }

        .close-btn {
            align-self: flex-end; /* Rechts oben im Container */
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-color);
            margin-bottom: 10px;
            margin-top: -10px;
        }

        .theme-switch-btn {
            background: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--btn-border);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            width: fit-content;
            transition: background 0.2s;
        }
        
        .theme-switch-btn:hover {
            filter: brightness(1.1);
        }

        /* --- PICKER STYLES --- */
        .picker-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            width: 100%;
            height: 160px;
        }

        .picker-separator {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-color);
            margin-top: -10px;
            opacity: 0.5;
        }

        .wheel-picker {
            width: 160px;
            height: 150px;
            background-color: var(--picker-bg);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 35%, black 65%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 35%, black 65%, transparent 100%);
        }

        .charger-picker { border-color: var(--charger-color); color: var(--charger-color); }
        .restaurant-picker { border-color: var(--food-color); color: var(--food-color); }

        .picker-strip {
            position: absolute;
            top: 0; left: 0; width: 100%;
            transform: translateY(0);
            transition: transform 3s cubic-bezier(0.1, 1.0, 0.2, 1.0); 
        }

        .picker-item {
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.1rem;
            white-space: nowrap;
            cursor: pointer;
        }

        .picker-highlight-bar {
            position: absolute;
            top: 50%; left: 0; width: 100%; height: 50px;
            margin-top: -25px;
            background-color: var(--picker-highlight);
            pointer-events: none;
            border-top: 1px solid rgba(255,255,255,0.15);
            border-bottom: 1px solid rgba(255,255,255,0.15);
            z-index: -1;
        }

        /* --- MAP & ICONS --- */
        #map {
            flex-grow: 1;
            width: 100%;
            z-index: 1; /* Map ganz unten */
        }

        .custom-div-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            font-size: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.6);
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .bg-tesla { background: #e82127; }
        .bg-ionity { background: #1e3d59; }
        .bg-enbw { background: #76c043; }
        .bg-mcd { background: #ffc72c; color: #000; } 
        .bg-bk { background: #512814; }
        
        .leaflet-popup-content-wrapper {
            background: var(--card-bg);
            color: var(--text-color);
            border-radius: 8px;
        }
        .leaflet-popup-tip {
            background: var(--card-bg);
        }

        /* Impressum Style Box */
        .imprint-box {
            border-top: 1px solid var(--btn-border);
            margin-top: 20px;
            padding-top: 15px;
            padding-bottom: 20px;
            font-size: 0.9rem;
            color: var(--muted-text);
        }
        .imprint-box strong {
            color: var(--text-color);
        }

    </style>
</head>
<body>

    <header>
        <h1>üîå Charge and Eat üçî</h1>
        <h1>Der Ladestoppfinder mit Essensoption</h1>        
        
        <!-- Burger Menu Button -->
        <div class="menu-btn" onclick="toggleMenu()" title="Men√º √∂ffnen">‚ò∞</div>
        
        <div class="picker-container">
            <!-- CHARGER PICKER -->
            <div class="wheel-picker charger-picker" id="picker-charger-container">
                <div class="picker-highlight-bar"></div>
                <div class="picker-strip" id="chargerStrip"></div>
            </div>

            <div class="picker-separator">+</div>

            <!-- RESTAURANT PICKER -->
            <div class="wheel-picker restaurant-picker" id="picker-food-container">
                <div class="picker-highlight-bar"></div>
                <div class="picker-strip" id="restaurantStrip"></div>
            </div>
        </div>
    </header>

    <main id="map"></main>

    <!-- SIDEBAR MENU (Rechts, 1/3 Breite) -->
    <div id="menu-overlay" class="menu-overlay">
        <!-- Close X oben rechts in der Leiste -->
        <div class="close-btn" onclick="toggleMenu()" title="Men√º schlie√üen">‚úï</div>
        
        <div class="menu-content">
            <!-- 1. Einstellungen -->
            <h2>Einstellungen</h2>
            <button class="theme-switch-btn" onclick="toggleTheme()">
                <span id="theme-btn-text">Dunkler Modus</span> 
                <span>‚òÄÔ∏è/üåô</span>
            </button>

            <!-- 2. Hintergrund -->
            <h2>Hintergrund</h2>
            <p>
                Wer kennt das nicht: Man sitzt im Auto, wei√ü man muss eh noch laden und w√ºrde das gern mit einem kurzen Snack verbinden. 
                Aber wo? "Charge and eat" bietet die L√∂sung. 
            </p>
            <p>
                Mit einem einfachen Filter kann entweder der Ladeanbieter oder das Fastfood-Restaurant ausgew√§hlt werden. Und schon wei√ü man Bescheid.
            </p>
            <p>
                Die Datenbank wird regelm√§√üig aktualisiert.<br>
                <span style="color: var(--charger-color); font-weight: bold;">Aktueller Stand: 01/2026</span>
            </p>
            <p>
                Falls ihr eine gute Idee f√ºr eine Verbesserung der Seite habt, schreibt mir gern unter: <a href="mailto:contact@chargeandeat.de?subject=Featurerequest">contact@chargeandeat.de</a>. 
            </p>

            <!-- 3. Rechtliches & Spa√ü -->
            <h2>Datenschutz & Co.</h2>
            <p>
                <strong>üç™ Cookies:</strong> Essen wir am liebsten selber. Daher verwendet diese Seite keine Tracking-Cookies und speichert keine pers√∂nlichen Daten auf unseren Servern. 
            </p>
            <p>
                <strong>üçî Haftung f√ºr Snacks:</strong> Diese Karte dient der groben Orientierung. Wir √ºbernehmen keine Gew√§hrleistung f√ºr die Verf√ºgbarkeit der Lades√§ulen, die Knusprigkeit der Pommes oder ob die Eismaschine bei McDonald's mal wieder "leider defekt" ist. Nutzung auf eigene Gefahr (und eigenen Hunger).
            </p>
            
            <!-- Impressum -->
            <div class="imprint-box">
                <h3>Impressum</h3>
                Angaben gem√§√ü ¬ß 3 DDG:<br><br>
                <strong>Max Mustermann</strong><br>
                c/o Online-Impressum.de #5479 <br>
                Europaring 90 <br>
                53757 Sankt Augustin <br>
                Deutschland<br><br>
                Kontakt: contact@chargeandeat.de
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
    /* --------------------------------------------------
       1. VARIABLEN
    -------------------------------------------------- */
    let allData = []; 
    let currentFilters = { chargerId: 'all', foodId: 'all' };
    const markerGroup = L.layerGroup(); 

    /* --------------------------------------------------
       2. UI & THEME LOGIK
    -------------------------------------------------- */
    function toggleMenu() {
        const overlay = document.getElementById('menu-overlay');
        overlay.classList.toggle('open');
    }

    function updateThemeButtonText(isLight) {
        const btnText = document.getElementById('theme-btn-text');
        btnText.innerText = isLight ? "Heller Modus aktiv" : "Dunkler Modus aktiv";
    }

    function initializeTheme() {
        const storedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        let isLight = false;

        if (storedTheme) {
            if (storedTheme === 'light') isLight = true;
        } else if (!prefersDark) {
            isLight = true;
            localStorage.setItem('theme', 'light');
        }

        if (isLight) document.body.classList.add('light-mode');
        else if (!storedTheme) localStorage.setItem('theme', 'dark');
        
        updateThemeButtonText(isLight);
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        const isLight = document.body.classList.contains('light-mode');
        localStorage.setItem('theme', isLight ? 'light' : 'dark');
        updateThemeButtonText(isLight);
    }

    /* --------------------------------------------------
       3. MAP INIT
    -------------------------------------------------- */
    const map = L.map('map').setView([50.35, 12.5], 8); 
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap' }).addTo(map);
    markerGroup.addTo(map); 

    /* --------------------------------------------------
       4. DATEN FILTERN & MARKER
    -------------------------------------------------- */
    function renderMarkers() {
        markerGroup.clearLayers(); 
        let count = 0;
        
        allData.forEach(entry => {
            const chargerMatch = (currentFilters.chargerId === 'all') || (entry.charger_id === currentFilters.chargerId);
            const foodMatch    = (currentFilters.foodId === 'all')    || (entry.food_id === currentFilters.foodId);
            
            if (chargerMatch && foodMatch) {
                count++;
                const myIcon = L.divIcon({
                    className: `custom-div-icon ${entry.badge_class}`,
                    html: `‚ö°`,
                    iconSize: [30, 30], iconAnchor: [15, 15], 
                });
                L.marker([entry.lat, entry.lon], {icon: myIcon}).addTo(markerGroup).bindPopup(entry.description); 
            }
        });
    }

    async function loadData() {
        try {
            const response = await fetch('data.json?t=' + new Date().getTime());
            if (!response.ok) throw new Error("Keine data.json gefunden");
            allData = await response.json();
            renderMarkers(); 
        } catch (error) {
            console.error(error);
        }
    }

    /* --------------------------------------------------
       5. PICKER LOGIK
    -------------------------------------------------- */
    const itemHeight = 50; 
    const pickerHeight = 150;

    const chargerOptions = [
        { id: 'tesla', text: 'Tesla' },
        { id: 'ionity', text: 'IONITY' },
        { id: 'enbw', text: 'EnBW' },
        { id: 'all', text: 'Alle Ladeanbieter' } 
    ];

    const foodOptions = [
        { id: 'mcdonald', text: "McDonald's" },
        { id: 'burger king', text: 'Burger King' },
        { id: 'lounge', text: 'Lounge' },
        { id: 'all', text: 'Alle Restaurants' }
    ];

    function initPickerStrip(stripId, options, repeatCount = 10) {
        const strip = document.getElementById(stripId);
        let htmlContent = '';
        for (let i = 0; i < repeatCount; i++) {
            options.forEach(opt => {
                htmlContent += `<div class="picker-item" data-id="${opt.id}">${opt.text}</div>`;
            });
        }
        strip.innerHTML = htmlContent;
    }

    function scrollToElement(stripId, targetElement, duration = null) {
        if(!targetElement) return;
        const strip = document.getElementById(stripId);
        
        if (duration !== null) strip.style.transition = `transform ${duration}`;
        else strip.style.transition = ''; 

        const items = Array.from(strip.querySelectorAll('.picker-item'));
        const index = items.indexOf(targetElement);

        if (index !== -1) {
            const centerOffset = (pickerHeight / 2) - (itemHeight / 2); 
            const totalScroll = (index * itemHeight) - centerOffset;
            strip.style.transform = `translateY(-${totalScroll}px)`;

            const selectedId = targetElement.getAttribute('data-id');
            if (stripId === 'chargerStrip') currentFilters.chargerId = selectedId;
            if (stripId === 'restaurantStrip') currentFilters.foodId = selectedId;
            renderMarkers();
        }
    }

    function spinToWin(stripId, targetId) {
        const strip = document.getElementById(stripId);
        const items = Array.from(strip.querySelectorAll('.picker-item'));
        const foundIndex = items.map(i => i.getAttribute('data-id')).lastIndexOf(targetId);
        if (foundIndex !== -1) scrollToElement(stripId, items[foundIndex]);
    }

    function initInteract(stripId, containerId) {
        const strip = document.getElementById(stripId);
        const container = document.getElementById(containerId);

        strip.addEventListener('click', (e) => {
            if(e.target.classList.contains('picker-item')) {
                strip.style.transition = 'transform 0.3s ease-out';
                scrollToElement(stripId, e.target, '0.3s ease-out');
            }
        });

        let isScrolling = false;
        container.addEventListener('wheel', (e) => {
            e.preventDefault();
            if (isScrolling) return;
            isScrolling = true;
            setTimeout(() => { isScrolling = false; }, 50); 
            const direction = e.deltaY > 0 ? 1 : -1;
            const items = strip.querySelectorAll('.picker-item');
            
            let currentY = 0;
            if (strip.style.transform) currentY = Math.abs(parseInt(strip.style.transform.replace('translateY(', '').replace('px)', '')));
            
            let currentIndex = Math.round((currentY - (pickerHeight/2 - itemHeight/2)) / itemHeight);
            let newIndex = currentIndex + direction;
            if (newIndex < 0) newIndex = 0;
            if (newIndex >= items.length) newIndex = items.length - 1;

            strip.style.transition = 'transform 0.1s linear';
            scrollToElement(stripId, items[newIndex], '0.1s linear');
        }, { passive: false });
    }

    /* --------------------------------------------------
       6. START
    -------------------------------------------------- */
    window.addEventListener('DOMContentLoaded', () => {
        initializeTheme();
        initPickerStrip('chargerStrip', chargerOptions, 10);
        initPickerStrip('restaurantStrip', foodOptions, 10);
        initInteract('chargerStrip', 'picker-charger-container');
        initInteract('restaurantStrip', 'picker-food-container');
        loadData();         

        setTimeout(() => {
            document.getElementById('chargerStrip').style.transition = 'transform 3s cubic-bezier(0.1, 1.0, 0.2, 1.0)';
            document.getElementById('restaurantStrip').style.transition = 'transform 3s cubic-bezier(0.1, 1.0, 0.2, 1.0)';
            spinToWin('chargerStrip', 'all');
            spinToWin('restaurantStrip', 'all');
        }, 100);
    });
    </script>
</body>
</html>
